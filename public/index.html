<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëšœê¸°ë¡œë“œ: ë¶€ì‚° ì‚¬íˆ¬ë¦¬ AI ì±—ë´‡</title>
    <!-- Tailwind CSS CDNì„ ë¡œë“œí•˜ì—¬ ìŠ¤íƒ€ì¼ë§ì„ ì ìš©í•©ë‹ˆë‹¤. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Noto Sans KR)ë¥¼ ë¡œë“œí•˜ì—¬ í•œê¸€ í°íŠ¸ë¥¼ ì ìš©í•©ë‹ˆë‹¤. -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ë°”ë”” ìŠ¤íƒ€ì¼: í°íŠ¸, ë°°ê²½ìƒ‰, í…ìŠ¤íŠ¸ ìƒ‰ìƒ, ë ˆì´ì•„ì›ƒ ì„¤ì • */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #FDFBF8; /* ë¶€ë“œëŸ¬ìš´ ë¯¸ìƒ‰ ë°°ê²½ */
            color: #343A40; /* ì§„í•œ íšŒìƒ‰ í…ìŠ¤íŠ¸ */
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* ìµœì†Œ ë†’ì´ë¥¼ ë·°í¬íŠ¸ ë†’ì´ë¡œ ì„¤ì • */
            overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        /* ì±„íŒ… ë²„ë¸” ê³µí†µ ìŠ¤íƒ€ì¼ */
        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            max-width: 75%; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            word-wrap: break-word; /* ê¸´ ë‹¨ì–´ ì¤„ë°”ê¿ˆ */
            box-shadow: 0 1px 3px rgba(0,0,0,0.08); /* ê·¸ë¦¼ì íš¨ê³¼ */
            animation: slideInFromBottom 0.3s ease-out forwards; /* ì•„ë˜ì—ì„œ ìœ„ë¡œ ìŠ¬ë¼ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜ */
        }
        /* ì‚¬ìš©ì ì±„íŒ… ë²„ë¸” ìŠ¤íƒ€ì¼ */
        .chat-bubble-user {
            background-color: #E0F2F7; /* ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½ */
            align-self: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
            margin-left: auto; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
        }
        /* ëšœê¸° ì±„íŒ… ë²„ë¸” ìŠ¤íƒ€ì¼ */
        .chat-bubble-tugi {
            background-color: #FFF3CD; /* ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½ */
            align-self: flex-start; /* ì™¼ìª½ ì •ë ¬ */
            margin-right: auto; /* ì™¼ìª½ ì •ë ¬ */
        }
        
        /* ëšœê¸° í—¤ë” ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .tugi-character-header {
            width: 4rem; /* 64px */
            height: 4rem;
            object-fit: contain; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€ */
            vertical-align: middle; /* í…ìŠ¤íŠ¸ì™€ ì„¸ë¡œ ì •ë ¬ */
        }
        /* ëšœê¸° ìºë¦­í„° ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ (ë°±ì—”ë“œ ì‘ë‹µì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì ìš©) */
        .buki-anim-bounce { animation: bounce 0.8s ease-out forwards; }
        .buki-anim-shake { animation: shake 0.5s ease-in-out forwards; }
        .buki-anim-pulse { animation: pulse 0.8s ease-out forwards; }
        .buki-anim-wobble { animation: wobble 0.6s ease-in-out forwards; }

        /* ì±„íŒ… ë²„ë¸” ë‚´ í° ëšœê¸° ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ë° ì• ë‹ˆë©”ì´ì…˜ */
        .tugi-large-image-in-chat {
            width: 9rem; /* ì•½ 144px */
            height: 9rem;
            object-fit: contain;
            display: block; /* ë¸”ë¡ ìš”ì†Œë¡œ ì„¤ì •í•˜ì—¬ ì¤„ë°”ê¿ˆ */
            margin: 0.5rem auto 0.5rem 0; /* ì™¼ìª½ ì •ë ¬ ë° ìœ„ì•„ë˜ ê°„ê²© */
            vertical-align: middle; /* (ë¸”ë¡ ìš”ì†Œì´ë¯€ë¡œ í° ì˜ë¯¸ ì—†ìŒ) */
            animation: fadeInScale 0.3s ease-out forwards; /* í˜ì´ë“œ ì¸ ë° ìŠ¤ì¼€ì¼ ì• ë‹ˆë©”ì´ì…˜ */
            opacity: 0; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }

        /* ì±„íŒ… ë‚´ ê´‘ê³  ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .in-chat-ad-card {
            background-color: #E6FFFA; /* ì—°í•œ ì²­ë¡ìƒ‰ ë°°ê²½ */
            border: 1px solid #B2F5EA; /* í…Œë‘ë¦¬ */
            border-radius: 1rem; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            padding: 1.5rem;
            margin: 1rem auto; /* ê°€ìš´ë° ì •ë ¬ ë° ìƒí•˜ ë§ˆì§„ */
            max-width: 85%;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* ê·¸ë¦¼ì */
            transition: opacity 0.5s ease-out; /* íˆ¬ëª…ë„ ì „í™˜ íš¨ê³¼ */
            animation: slideInFromBottom 0.5s ease-out forwards; /* ì•„ë˜ì—ì„œ ìœ„ë¡œ ìŠ¬ë¼ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜ */
        }
        .in-chat-ad-card.hidden {
            opacity: 0;
            pointer-events: none; /* ìˆ¨ê²¨ì§„ ìƒíƒœì—ì„œëŠ” í´ë¦­ ì´ë²¤íŠ¸ ë¬´ì‹œ */
        }

        /* Keyframe ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-5px); } 40%, 80% { transform: translateX(5px); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes wobble { 0%, 100% { transform: translateX(0%); transform-origin: 50% 50%; } 15% { transform: translateX(-25%) rotate(-5deg); } 30% { transform: translateX(20%) rotate(3deg); } 45% { transform: translateX(-15%) rotate(-3deg); } 60% { transform: translateX(10%) rotate(2deg); } 75% { transform: translateX(-5%) rotate(-1deg); } }
        @keyframes slideInFromBottom { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes adPopIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        @keyframes adPopOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.8); } }

        /* ë¡œë”© ì¸ë””ì¼€ì´í„° ì  ì• ë‹ˆë©”ì´ì…˜ */
        .loading-dots span { animation: blink 1s infinite; }
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
        /* ì¹´ë“œ í˜ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜ */
        .card-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- í—¤ë” ì„¹ì…˜: ë¡œê³ /íƒ€ì´í‹€ë§Œ ë‚¨ê¹€ -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm py-4">
        <div class="max-w-4xl mx-auto px-4 flex items-center justify-center"> <!-- justify-centerë¡œ ë³€ê²½ -->
            <span id="header-title-link" class="text-3xl font-bold text-gray-800 flex items-center cursor-pointer">
                <img id="tugi-image-header" src="https://firebasestorage.googleapis.com/v0/b/ddugidata.firebasestorage.app/o/Untitled%20(2)%20(1).png?alt=media&token=b3754220-4e08-4925-852b-1bb862b9fca5" alt="ëšœê¸° ìºë¦­í„°" class="tugi-character-header mr-2"> ëšœê¸°
            </span>
            <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì œê±° -->
            <nav class="flex space-x-4">
                <!-- <button id="nav-login" class="text-lg font-medium text-gray-700 hover:text-blue-600 transition-colors duration-200">ë¡œê·¸ì¸</button> -->
                <!-- <button id="nav-logout" class="text-lg font-medium text-gray-700 hover:text-blue-600 transition-colors duration-200 hidden">ë¡œê·¸ì•„ì›ƒ</button> -->
            </nav>
        </div>
    </header>

    <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
    <main class="flex-grow max-w-4xl mx-auto w-full p-4 flex flex-col">
        <!-- ì±„íŒ… í˜ì´ì§€ (ê¸°ë³¸ì ìœ¼ë¡œ í‘œì‹œ) -->
        <div id="chat-page" class="flex-grow bg-white rounded-xl shadow-lg p-6 flex flex-col overflow-hidden">
            <!-- ì±„íŒ… ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
            <div id="chat-window" class="flex-grow flex flex-col space-y-4 overflow-y-auto pr-2 pb-4">
                <!-- ì´ˆê¸° ëšœê¸° ë©”ì‹œì§€ -->
                <div class="chat-bubble chat-bubble-tugi">
                    <p class="font-bold mb-1">ëšœê¸°</p>
                    <br>
                    <img src="https://firebasestorage.googleapis.com/v0/b/ddugidata.firebasestorage.app/o/Untitled%20(2)%20(1).png?alt=media&token=b3754220-4e08-4925-852b-1bb862b9fca5" alt="ëšœê¸°" class="tugi-large-image-in-chat">
                    <br>
                    <p>ë§ˆ! ë¶€ì‚°ì€ ëª¨ë¥´ëŠ”ê²Œ ì—†ëŠ” ì‹¸ë‚˜ì´ AI 'ëšœê¸°'ë‹¤. ë°¥ ë¬µìë‚˜?!</p>
                </div>

                <!-- ëŒ€í™”ì°½ ë‚´ ê´‘ê³  ì¹´ë“œ -->
                <div id="in-chat-ad" class="in-chat-ad-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">ğŸ‰ 'ëšœê¸°ë¡œë“œ' ì˜¤í”ˆ ê¸°ë… ì´ë²¤íŠ¸! ğŸ‰</h3>
                    <p class="text-gray-700 mb-4">
                        ì§€ê¸ˆ 'ëšœê¸°'ì™€ ëŒ€í™”í•˜ê³  ë¶€ì‚° ìˆ¨ì€ ë§›ì§‘ í• ì¸ ì¿ í° ë°›ìœ¼ì„¸ìš”!<br>
                        (ê¸°ê°„ í•œì •, ì„ ì°©ìˆœ 100ëª…)
                    </p>
                    <img src="https://placehold.co/400x200/FFC3A0/343A40?text=ì´ë²¤íŠ¸+ê´‘ê³ " alt="ì´ë²¤íŠ¸ ê´‘ê³ " class="rounded-lg shadow-sm mx-auto mb-2 max-w-full h-auto">
                    <p class="text-sm text-gray-500">ë‹¤ìŒì— ë³´ê¸°.</p>
                </div>

            </div>

            <!-- ë¡œë”© ì¸ë””ì¼€ì´í„° -->
            <div id="loading-indicator" class="hidden text-gray-500 text-sm mt-2 mb-4">
                ëšœê¸°ê°€ ìƒê° ì¤‘... <span class="loading-dots"><span>.</span><span>.</span><span>.</span></span>
            </div>

            <!-- ë§›ì§‘ ì¶”ì²œ ì •ë³´ í‘œì‹œ ì˜ì—­ -->
            <div id="recommendation-area" class="mt-4 hidden">
                <h3 class="text-xl font-bold mb-3 text-center">ëšœê¸°ê°€ ì¶”ì²œí•˜ëŠ” ë§›ì§‘!</h3>
                <div id="restaurant-card-container" class="bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-md flex flex-col sm:flex-row items-center sm:items-start gap-4">
                    <!-- ë§›ì§‘ ì¹´ë“œëŠ” JavaScriptë¡œ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤. -->
                </div>
            </div>

            <!-- ì‚¬ìš©ì ì…ë ¥ í•„ë“œ ë° ì „ì†¡ ë²„íŠ¼ -->
            <div class="mt-4 flex">
                <input type="text" id="user-input" class="flex-grow p-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ëšœê¸°ì—ê²Œ ì§ˆë¬¸í•˜ì„¸ìš”...">
                <button id="send-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-r-lg transition duration-200">
                    ì „ì†¡
                </button>
            </div>
        </div>

        <!-- ë¡œê·¸ì¸ í˜ì´ì§€ ì œê±° -->
        <!-- <div id="login-page" class="hidden flex-grow bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">ë¡œê·¸ì¸</h2>
            <div class="w-full max-w-sm">
                <div id="g_id_onload"
                     data-client_id="YOUR_GOOGLE_CLIENT_ID"
                     data-callback="handleGoogleAuthResponse"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="sign_in_with"
                     data-shape="rectangular"
                     data-logo_alignment="left">
                </div>
                
                <p id="login-status" class="mt-4 text-center text-red-500"></p>
            </div>
        </div> -->
    </main>

    <!-- í‘¸í„° ì„¹ì…˜ -->
    <footer class="bg-gray-800 text-white py-6 mt-8">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <p>&copy; 2025 ëšœê¸°. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ .</p>
            <p class="text-sm text-gray-400 mt-1">Gemini API ê¸°ë°˜ ë¶€ì‚° ì‚¬íˆ¬ë¦¬ ì±—ë´‡</p>
        </div>
    </footer>

    <!-- Google Sign-In í”Œë«í¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œê±° -->
    <!-- <script src="https://accounts.google.com/gsi/client" async defer></script> -->

    <script type="module">
        // Firebase í´ë¼ì´ì–¸íŠ¸ SDK ì„í¬íŠ¸ ì œê±° (ì¸ì¦ ê´€ë ¨ ê¸°ëŠ¥ ì œê±°)
        // import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        // import { getAuth, signInWithCustomToken, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        
        // Firebase Config ì œê±°
        // const firebaseConfig = { ... };
        // const firebaseApp = initializeApp(firebaseConfig);
        // const auth = getAuth(firebaseApp);

        // const initialAuthToken = ...;
        // if (initialAuthToken) { ... }

        // --- DOM ìš”ì†Œ ì°¸ì¡° ---
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const recommendationArea = document.getElementById('recommendation-area');
        const restaurantCardContainer = document.getElementById('restaurant-card-container');
        const tugiImageHeader = document.getElementById('tugi-image-header');
        const inChatAd = document.getElementById('in-chat-ad');

        const chatPage = document.getElementById('chat-page');
        // const loginPage = document.getElementById('login-page'); // ì œê±°
        // const navLoginBtn = document.getElementById('nav-login'); // ì œê±°
        // const navLogoutBtn = document.getElementById('nav-logout'); // ì œê±°
        const headerTitleLink = document.getElementById('header-title-link');
        // const loginStatusText = document.getElementById('login-status'); // ì œê±°

        const allPages = [chatPage]; // ë¡œê·¸ì¸ í˜ì´ì§€ ì œê±°

        let chatHistory = [];
        // let currentUser = null; // ì œê±°

        // ëšœê¸° ì´ë¯¸ì§€ URL ë§µ (í”„ë¡ íŠ¸ì—”ë“œì—ì„œë„ ì°¸ì¡°)
        const tugiImageMap = {
            'default': 'https://firebasestorage.googleapis.com/v0/b/ddugidata.firebasestorage.app/o/Untitled%20(2)%20(1).png?alt=media&token=b3754220-4e08-4925-852b-1bb862b9fca5',
            'recommend': 'https://firebasestorage.googleapis.com/v0/b/ddugidata.firebasestorage.app/o/Untitled%20(4).png?alt=media&token=b113ec37-7c12-4b93-96fd-1818ed093f97',
            'thinking': 'https://firebasestorage.googleapis.com/v0/b/ddugidata.firebasestorage.app/o/Untitled%20(Copy).png?alt=media&token=8bef4637-6651-47c0-b5a6-177d810cf9bf',
            'greeting': 'https://placehold.co/100x100/B2F5EA/343A40?text=ëšœê¸°_ì¸ì‚¬',
            'positive': 'https://placehold.co/100x100/C3F7D2/343A40?text=ëšœê¸°_ê¸ì •',
            'error': 'https://placehold.co/100x100/FF9999/343A40?text=ëšœê¸°_ì—ëŸ¬'
        };

        // íŠ¹ì • í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ê³  ë‚˜ë¨¸ì§€ í˜ì´ì§€ë¥¼ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜ (ì´ì œ í•„ìš” ì—†ìŒ, chatPageë§Œ ìˆìœ¼ë¯€ë¡œ)
        function showPage(pageToShow) {
            allPages.forEach(page => {
                if (page === pageToShow) {
                    page.classList.remove('hidden');
                    page.classList.add('flex');
                } else {
                    page.classList.add('hidden');
                    page.classList.remove('flex');
                }
            });
            window.scrollTo(0, 0);
        }

        // Firebase ì¸ì¦ ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ ì œê±°
        // onAuthStateChanged(auth, (user) => { ... });

        // ì±„íŒ… ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
        function addMessage(sender, text, isTugi = false, tugiImageUrl = tugiImageMap['default']) { Â 
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-bubble ${isTugi ? 'chat-bubble-tugi' : 'chat-bubble-user'} mt-2`;

            if (isTugi) {
                const tugiNameParagraph = document.createElement('p');
                tugiNameParagraph.className = 'font-bold mb-1';
                tugiNameParagraph.textContent = 'ëšœê¸°';

                const tugiLargeImageInChat = document.createElement('img');
                tugiLargeImageInChat.src = tugiImageUrl;
                tugiLargeImageInChat.alt = 'ëšœê¸°';
                tugiLargeImageInChat.className = 'tugi-large-image-in-chat';

                const textParagraph = document.createElement('p');
                textParagraph.textContent = text;

                messageDiv.appendChild(tugiNameParagraph);
                messageDiv.appendChild(document.createElement('br'));
                messageDiv.appendChild(tugiLargeImageInChat);
                messageDiv.appendChild(document.createElement('br'));
                messageDiv.appendChild(textParagraph);

                tugiImageHeader.src = tugiImageUrl;
                tugiImageHeader.classList.remove('buki-anim-bounce', 'buki-anim-shake', 'buki-anim-pulse', 'buki-anim-wobble');

                let animationClass = '';
                if (tugiImageUrl.includes('ëšœê¸°_ì¶”ì²œ')) {
                    animationClass = 'buki-anim-bounce';
                } else if (tugiImageUrl.includes('ëšœê¸°_ìƒê°')) {
                    animationClass = 'buki-anim-wobble';
                } else if (tugiImageUrl.includes('ëšœê¸°_ì¸ì‚¬')) {
                    animationClass = 'buki-anim-bounce';
                } else if (tugiImageUrl.includes('ëšœê¸°_ê¸ì •')) {
                    animationClass = 'buki-anim-pulse';
                } else if (tugiImageUrl.includes('ëšœê¸°_ì—ëŸ¬')) {
                    animationClass = 'buki-anim-shake';
                } else {
                    animationClass = 'buki-anim-pulse';
                }

                if (animationClass) {
                    tugiImageHeader.classList.add(animationClass);
                    setTimeout(() => {
                        tugiImageHeader.classList.remove(animationClass);
                    }, 800);
                }

            } else {
                messageDiv.innerHTML = `<p class="font-bold mb-1">ë‚˜</p><p>${text}</p>`;
            }

            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function displayRestaurantCard(restaurantData) {
            if (!restaurantData) {
                recommendationArea.classList.add('hidden');
                restaurantCardContainer.innerHTML = '';
                return;
            }

            recommendationArea.classList.remove('hidden');
            recommendationArea.classList.add('card-fade-in');

            restaurantCardContainer.innerHTML = `
                <img src="${restaurantData.image_url || 'https://placehold.co/400x300/CCCCCC/FFFFFF?text=No+Image'}" alt="${restaurantData.name} ì´ë¯¸ì§€" class="w-full sm:w-40 h-32 sm:h-auto object-cover rounded-lg shadow-sm">
                <div class="flex-grow">
                    <h4 class="text-lg font-bold text-blue-700 mb-1">${restaurantData.name} (${restaurantData.location})</h4>
                    <p class="text-gray-700 text-sm">${restaurantData.desc}</p>
                    <a href="https://www.google.com/maps/search/${encodeURIComponent(restaurantData.name + ' ë¶€ì‚° ' + restaurantData.location)}" target="_blank" class="text-blue-500 hover:underline text-sm mt-2 inline-block">
                        ì§€ë„ì—ì„œ ë³´ê¸° â†—
                    </a>
                </div>
            `;
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // ì‚¬ìš©ì ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
        async function sendMessage() {
            const message = userInput.value.trim();
            if (message === '') return;

            // ë¡œê·¸ì¸ ì²´í¬ ë¡œì§ ì œê±°
            // if (!currentUser) { ... return; }

            if (!inChatAd.classList.contains('hidden')) {
                inChatAd.classList.add('hidden');
            }

            addMessage('user', message);
            userInput.value = '';
            sendButton.disabled = true;
            loadingIndicator.classList.remove('hidden');

            recommendationArea.classList.add('hidden');
            recommendationArea.classList.remove('card-fade-in');

            chatHistory.push({ role: "user", parts: [{ text: message }] });

            try {
                // ID í† í° ê°€ì ¸ì˜¤ëŠ” ë¡œì§ ì œê±°
                // const idToken = await currentUser.getIdToken();

                // TODO: ì—¬ê¸°ì— ë‹¹ì‹ ì˜ Cloud Function URLì„ ì…ë ¥í•˜ì„¸ìš”.
                const backendApiBaseUrl = 'https://us-central1-ddugidata.cloudfunctions.net/api'; // <-- ì´ ë¶€ë¶„ì„ ì‹¤ì œ URLë¡œ êµì²´!

                const response = await fetch(`${backendApiBaseUrl}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // 'Authorization': `Bearer ${idToken}` // Authorization í—¤ë” ì œê±°
                    },
                    body: JSON.stringify({ message: message, history: chatHistory })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }

                const data = await response.json();
                const tugiResponseImageUrl = data.tugi_image_url || tugiImageMap['default'];
                addMessage('tugi', data.reply, true, tugiResponseImageUrl);

                chatHistory.push({ role: "model", parts: [{ text: data.reply }] });

                if (data.restaurant) {
                    displayRestaurantCard(data.restaurant);
                } else {
                    displayRestaurantCard(null);
                }

            } catch (error) {
                console.error('ë©”ì‹œì§€ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                // ì¸ì¦ ì˜¤ë¥˜ ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§ ì œê±°
                // if (error.message.includes('ì¸ì¦ë˜ì§€ ì•Šì€ ìš”ì²­') || error.message.includes('ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ í† í°')) { ... } else { ... }
                addMessage('tugi', 'ëšœê¸°ê°€ ì ì‹œ ë© ë•Œë¦¬ê³  ìˆì‹¬ë”... ë‹¤ì‹œ ë§ ê±¸ì–´ì£¼ì´ì†Œ.', true, tugiImageMap['error']);
                displayRestaurantCard(null);
            } finally {
                sendButton.disabled = false;
                loadingIndicator.classList.add('hidden');
                userInput.focus();
            }
        }

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        inChatAd.addEventListener('click', () => {
            if (!inChatAd.classList.contains('hidden')) {
                inChatAd.classList.add('hidden');
            }
        });

        // Google Sign-In Callback í•¨ìˆ˜ ì œê±°
        // window.handleGoogleAuthResponse = async (response) => { ... };

        // ë¡œê·¸ì•„ì›ƒ ë¡œì§ ì œê±°
        // navLogoutBtn.addEventListener('click', async () => { ... });

        // ë‚´ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë¡œê·¸ì¸ ë²„íŠ¼ ê´€ë ¨ ì œê±°)
        // navLoginBtn.addEventListener('click', () => showPage(loginPage));
        headerTitleLink.addEventListener('click', () => showPage(chatPage));

        // ì´ˆê¸° í˜ì´ì§€ ë¡œë“œ ì‹œ ì±„íŒ… í˜ì´ì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
        showPage(chatPage);
    </script>
</body>
</html>
